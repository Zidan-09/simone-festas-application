generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @map("user_id") @db.Uuid
  username     String
  contact      String?
  email        String    @unique
  address      Json
  passwordHash String    @map("password_hash")
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  isAdmin      Boolean?  @default(false) @map("is_admin")
  events       Event[]

  @@map("users")
}

model Theme {
  id        String        @id @default(dbgenerated("gen_random_uuid()")) @map("theme_id") @db.Uuid
  name      String
  mainImage String        @map("principal_picture")
  category  ThemeCategory
  createdAt DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  keyWords  String[]
  images    ThemeImage[]
  kits      EventKit[]

  @@map("themes")
}

model ThemeImage {
  id      String @id @default(dbgenerated("gen_random_uuid()")) @map("theme_image_id") @db.Uuid
  themeId String @map("theme_id") @db.Uuid
  url     String @map("image_url")
  theme   Theme  @relation(fields: [themeId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_theme_images_theme")

  @@map("theme_images")
}

model Item {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @map("item_id") @db.Uuid
  name        String        @unique
  description String
  type        ItemType
  price       Decimal       @db.Decimal(10, 2)
  createdAt   DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  variants    ItemVariant[]

  @@map("items")
}

model ItemVariant {
  id          String  @id @default(dbgenerated("gen_random_uuid()")) @map("variant_id") @db.Uuid
  itemId      String  @map("item_id") @db.Uuid
  variant     String?
  image       String?
  quantity    Int     @default(0) @map("stock_quantity")
  item        Item    @relation(fields: [itemId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_item_variants_item")
  keyWords    String[]
  eventItems  EventItem[]
  eventKits   EventKit[]
  eventTable  EventTable[]

  @@map("item_variants")
}

model Event {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @map("event_id") @db.Uuid
  ownerId       String    @map("owner_id") @db.Uuid
  eventDate     DateTime  @map("event_date") @db.Timestamptz(6)
  address       Json      @map("event_address")
  totalPrice    Decimal   @default(0) @map("total_price") @db.Decimal(10, 2)
  totalPaid     Decimal   @default(0) @map("total_paid")  @db.Decimal(10, 2)
  status        EventStatus
  reserveType   String    @map("reserve_type")
  createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)

  owner      User      @relation(fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_events_owner")
  services   EventService[]
  items      EventItem[]
  kits       EventKit[]
  tables     EventTable[]

  @@map("events")
}

model Service {
  id        String         @id @default(dbgenerated("gen_random_uuid()")) @map("service_id") @db.Uuid
  name      String
  price     Decimal        @db.Decimal(10, 2)
  createdAt DateTime?      @default(now()) @map("created_at") @db.Timestamptz(6)
  events    EventService[]

  @@map("services")
}

model EventService {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @map("event_service_id") @db.Uuid
  eventId   String  @map("event_id") @db.Uuid
  serviceId String  @map("service_id") @db.Uuid

  event   Event   @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_services_event")
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_services_service")

  @@unique([eventId, serviceId])

  @@map("event_services")
}

model EventItem {
  id              String      @id                     @default(dbgenerated("gen_random_uuid()"))  @map("event_item_id")  @db.Uuid
  eventId         String      @map("event_id")        @db.Uuid
  itemVariantId   String      @map("item_variant_id") @db.Uuid
  quantity        Int         @map("item_quantity")
  returnedAt      DateTime?   @map("returned_at")     @db.Timestamptz(6)

  event           Event       @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_items_event")
  itemVariant     ItemVariant @relation(fields: [itemVariantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_items_item")

  @@unique([eventId, itemVariantId])

  @@map("event_items")
}

model EventKit {
  id              String      @id                     @default(dbgenerated("gen_random_uuid()"))  @map("event_kit_id")  @db.Uuid
  eventId         String      @map("event_id")        @db.Uuid
  themeId         String      @map("theme_id")        @db.Uuid
  tablesId        String      @map("tables_id")       @db.Uuid
  kitType         KitType     @map("kit_type")

  event           Event       @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_kit_event")
  theme           Theme       @relation(fields: [themeId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_kit_theme")
  tables          ItemVariant @relation(fields: [tablesId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_kit_tables")

  @@unique([eventId])

  @@map("event_kit")
}

model EventTable {
  id              String      @id                     @default(dbgenerated("gen_random_uuid()"))  @map("event_table_id")  @db.Uuid
  eventId         String      @map("event_id")        @db.Uuid
  colorId         String      @map("color_id")        @db.Uuid
  numberOfPeople  Int         @map("number_of_people")

  event           Event       @relation(fields: [eventId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_table_event")
  color           ItemVariant @relation(fields: [colorId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_table_color")

  @@unique([eventId])

  @@map("event_table")
}

enum ItemType {
  CURTAIN
  PANEL
  DESSERT_STAND
  TABLE
  RUG
  EASEL
  TABLE_SETTING

  @@map("item_type")
}

enum ThemeCategory {
  KIDS
  ADULTS
  SPECIAL_EVENTS
  HOLIDAYS

  @@map("theme_category")
}

enum EventStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELED
  POSTPONED

  @@map("event_status")
}

enum KitType {
  SIMPLE
  CYLINDER

  @@map("kit_type")
}