generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @map("user_id") @db.Uuid
  username     String
  contact      String?
  email        String    @unique
  address      Json?
  passwordHash String    @map("password_hash")
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  isAdmin      Boolean?  @default(false) @map("is_admin")
  events       Event[]

  @@map("users")
}

model Theme {
  id        String        @id @default(dbgenerated("gen_random_uuid()")) @map("theme_id") @db.Uuid
  name      String
  mainImage String?       @map("principal_picture")
  category  ThemeCategory
  createdAt DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  images    ThemeImage[]
  items     ThemeItem[]

  @@map("themes")
}

model ThemeImage {
  id      String @id @default(dbgenerated("gen_random_uuid()")) @map("theme_image_id") @db.Uuid
  themeId String @map("theme_id") @db.Uuid
  url     String @map("image_url")
  theme   Theme  @relation(fields: [themeId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_theme_images_theme")

  @@map("theme_images")
}

model ThemeItem {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @map("theme_item_id") @db.Uuid
  themeId  String @map("theme_id") @db.Uuid
  itemId   String @map("item_id") @db.Uuid
  quantity Int
  item     Item   @relation(fields: [itemId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_theme_items_item")
  theme    Theme  @relation(fields: [themeId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_theme_items_theme")

  @@unique([themeId, itemId], name: "unique_theme_item", map: "unique_theme_item")
  @@map("theme_items")
}

model Item {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @map("item_id") @db.Uuid
  name        String        @unique
  description String
  type        ItemType
  price       Decimal       @db.Decimal(10, 2)
  createdAt   DateTime      @default(now()) @map("created_at") @db.Timestamptz(6)
  variants    ItemVariant[]
  themes      ThemeItem[]

  @@map("items")
}

model ItemVariant {
  id       String  @id @default(dbgenerated("gen_random_uuid()")) @map("variant_id") @db.Uuid
  itemId   String  @map("item_id") @db.Uuid
  color    String
  image    String
  quantity Int     @default(0) @map("stock_quantity")
  item     Item    @relation(fields: [itemId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_item_variants_item")

  @@map("item_variants")
}

model Event {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @map("event_id") @db.Uuid
  ownerId    String    @map("owner_id") @db.Uuid
  eventDate  DateTime? @map("event_date") @db.Timestamptz(6)
  address    Json?     @map("event_address")
  totalPrice Decimal   @default(0) @map("total_price") @db.Decimal(10, 2)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  owner      User      @relation(fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_events_owner")

  @@map("events")
}

model Service {
  id        String         @id @default(dbgenerated("uuid_generate_v4()")) @map("service_id") @db.Uuid
  name      String
  price     Decimal        @db.Decimal(10, 2)
  createdAt DateTime?      @default(now()) @map("created_at") @db.Timestamptz(6)
  events    EventService[]

  @@map("services")
}

model EventService {
  id        String  @id @default(dbgenerated("uuid_generate_v4()")) @map("event_service_id") @db.Uuid
  eventId   String  @map("event_id") @db.Uuid
  serviceId String  @map("service_id") @db.Uuid
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_event_services_service")

  @@map("event_services")
}

enum ItemType {
  CURTAIN
  PANEL
  DESSERT_STAND
  TABLE
  RUG
  EASEL

  @@map("item_type")
}

enum ThemeCategory {
  KIDS
  ADULTS
  SPECIAL_EVENTS
  HOLIDAYS

  @@map("theme_category")
}
